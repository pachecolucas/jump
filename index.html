<!DOCTYPE html>
<html lang="pt-br" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title>Jogo de pular</title>
    <style>
      canvas {
        display: block;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <script type="text/javascript">
      let ctx,
        distancia = 0,
        posObstaculo = 800,
        j,
        o,
        t;

      class Desenho {
        constructor(x, y, w, h, c) {
          this.x = x;
          this.y = y;
          this.w = w;
          this.h = h;
          this.c = c;
        }

        desenha() {
          ctx.fillStyle = this.c;
          ctx.fillRect(this.x, this.y, this.w, this.h);
        }
      }

      class DesenhoMovel extends Desenho {
        constructor(x, y, w, h, c) {
          super(x, y, w, h, c);
          this.linhaA = new Linha(this.x);
          this.linhaB = new Linha(this.x + this.w);
        }

        desenha() {
          super.desenha();
          this.linhaA.x = this.x;
          this.linhaB.x = this.x + this.w;
          this.linhaA.desenha();
          this.linhaB.desenha();
        }

        atualiza() {}
      }

      class Jogador extends DesenhoMovel {
        constructor() {
          super(50, 50, 100, 100, "green");
        }

        desenha() {
          super.desenha();
        }

        atualiza() {
          if (this.y + this.h >= 600) {
            this.y = 500;
          } else {
            this.y += 26;
          }
        }
      }

      class Obstaculo extends DesenhoMovel {
        constructor() {
          super(800, 500, 50, 100, "red");
        }

        desenha() {
          super.desenha();
        }

        atualiza() {
          this.x -= 20;
        }
      }

      class Tiro extends DesenhoMovel {
        constructor() {
          super(800, 300, 100, 20, "blue");
        }

        desenha() {
          super.desenha();
        }

        atualiza() {
          this.x -= 30;
        }
      }

      class Linha extends Desenho {
        constructor(x) {
          super(x, 0, 1, 600, "red");
        }
      }

      function main() {
        // cria o canvas (área do jogo)
        let canvas = document.createElement("canvas");
        canvas.width = 800;
        canvas.height = 600;
        document.body.appendChild(canvas);

        // pega o ctx (caneta para desenhar)
        ctx = canvas.getContext("2d");
        window.setInterval("loop()", 500);

        // cria o jogador
        j = new Jogador();

        // cria obstáculo
        o = new Obstaculo();

        // cria tiro
        t = new Tiro();
      }

      function loop() {
        console.log("chamou loop() ...");
        // limpa tudo
        ctx.fillStyle = "#F5F5F5";
        ctx.fillRect(0, 0, 800, 600);

        // desenha o jogador
        j.desenha();

        // desenha obstáculo
        o.desenha();

        // desenha tiro
        t.desenha();

        // verifica colisão
        let a = j.x,
          b = j.x + j.w,
          c = o.x,
          d = o.x + o.w;
        if (b >= c && a <= d) {
          alert("colidiu");
        }

        // atualiza todos
        j.atualiza();
        o.atualiza();
        t.atualiza();
        console.log(j, o);
      }

      main();
    </script>
  </body>
</html>
