
<!DOCTYPE html>
<html lang="pt-br" dir="ltr">
<head>
  <meta charset="utf-8">
  <title>Jogo de pular</title>
  <style>
  canvas {
    display: block;
    margin: 0 auto;
  }
  </style>
</head>
<body>

<script type="text/javascript">

  class Desenho {
    constructor(x, y, w, h, c) {
      this.x = x;
      this.y = y;
      this.w = w;
      this.h = h;
      this.c = c;
  }

    desenha(ctx) {
      ctx.fillStyle = this.c;
      ctx.fillRect(this.x, this.y, this.w, this.h);
    }

  }

  class Chao extends Desenho {
    constructor() {
      super(0, 550, 800, 50, "#004400");
    }
  }


  class Jogador extends Desenho {

    constructor() {
      super(50, 50, 100, 100, "green");
      let self = this;
      document.addEventListener("mousedown", function(){
        self.pula();
      });
    }

    desenha(ctx) {
      if (this.y + this.h >= 550) { // chegou no chão?
        this.y = 450;
      } else { // se não chegou, continua caindo
        this.y += 26;
      }
      super.desenha(ctx);
    }

    pula() {
      this.y -= 100;
    }

    colidiu(obstaculos) {
      for(var i = 0; i < obstaculos.length; i++) {
        var o = obstaculos[i];
        //console.log("Jogador", this.x + this.w);
        //console.log("Obstáculo", o.x);
        if (this.x + this.w >= o.x && this.x <= o.x + o.w) { // colide verticalmente
            console.log("COLISAO VERTICAL!");
            if (this.y + this.h >= o.y && this.y <= o.y + o.h) {// colide horizontalmente
              console.log("COLISAO HORIZONTAL!");
              return true;
            }
        }
      }
      return false;
    }

  }

  class Obstaculo extends Desenho {

    constructor() {
      super(800, 450, 50, 100, "red");
    }

    desenha(ctx) {
      this.x -= 25;
      super.desenha(ctx);
    }

  }

  class Fundo extends Desenho {
    constructor() {
      super(0,0,800,600,"#DDDDFF");
    }
  }

  class Jogo {

    constructor() {
      // cria o canvas
      this.setCanvas();
      this.inicia();
      this.conta = 1;
      this.jogando = true;
    }

    setCanvas() {
      let canvas = document.createElement("canvas");
      canvas.width = 800;
      canvas.height = 600;
      document.body.appendChild(canvas);
      this.ctx = canvas.getContext("2d");
    }

    inicia() {
      this.fundo = new Fundo();
      this.j = new Jogador();
      this.chao = new Chao();
      this.obstaculos = [];
      this.obstaculos.push(new Obstaculo());
      var self = this;
      setInterval(function(){return self.repete();}, 500);
    }

    limpaTela() {
      this.fundo.desenha(this.ctx);
    }

    repete() {
      if (!this.jogando) {
        console.log("Eu não vou entrar aqui!");
        return false;
      }
      console.log("REPETINDO...", this.conta);
      this.conta++;

      this.limpaTela();
      this.chao.desenha(this.ctx);
      this.j.desenha(this.ctx);
      this.obstaculos[0].desenha(this.ctx);
      if (this.j.colidiu(this.obstaculos)) {
        this.jogando = false;
        console.log("FIM DE JOGO!");
      }
    }
  }

  let jogo = new Jogo();

  </script>

</html>
